<!DOCTYPE html>
<html amp lang="en">
  <head>

    <meta charset="utf-8">
    <title>О settings.py и хранении "секретных" настроек</title>
    <link rel="canonical" href="https://ru.vahaah.guru//2015/02/28/o-settings-py-i-khranienii-siekrietnykh-nastroiek.html">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://ru.vahaah.guru//2015/02/28/o-settings-py-i-khranienii-siekrietnykh-nastroiek.html"
        },
        "headline": "О settings.py и хранении "секретных" настроек",
        "image": {
          "@type": "ImageObject",
          "url": "https://ru.vahaah.guru.com/images/face.jpg",
          "height": 769,
          "width": 1024
        },
        "datePublished": "2015-02-28 13:32:00",
        "dateModified": "2015-02-28 13:32:00",
        "author": {
          "@type": "Person",
          "name": "Alex Vakhitov"
        },
        "publisher": {
          "@type": "Organization",
          "name": "ru.vahaah.guru",
          "logo": {
            "@type": "ImageObject",
            "url": "https://ru.vahaah.guru/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "",
        "keywords": [""]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
<noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500">
    <style amp-custom="amp-custom">

      body { font-family: serif; padding: .5em; font-size: 1.2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
      pre, code { font-family: 'Source Code Pro', 'Courier New', monospace; font-size: .8em; }
      code { padding: 0 .3em; background-color: lightgray; }
      a, a:hover, a:visited { color: inherit; }
      .intro { color: red; font-size: .75em; }
      .photo { border-radius: 50%; }
      pre { overflow-x:scroll; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <p class="intro">
        This is a mobile version, full one is
        <a href="https://ru.vahaah.guru//2015/02/28/o-settings-py-i-khranienii-siekrietnykh-nastroiek.html">here</a>.
      </p>
      <p>
        <amp-img src="/images/face-256x256.jpg" width="80" height="80" alt="" class="photo"></amp-img>
      </p>
      <p><br>28 February 2015</p>
      <h1>О settings.py и хранении "секретных" настроек</h1>
      <p>Я уже писал о настройках в этом <a href="//2014/04/28/luchshiie-praktiki-django.html">посте</a>. Но в последнее время я пересмотрел свое мнение по поводу хранения настроек, мне кажется использование файла local_settings.py избыточно и ведет к лишнему копипасту при работе с проектом. В последнее время я перел к такому формату:</p>



<pre>settings/
    __init__.py
     base.py
     local.py
     dev.py
     production.py
     test.py
     ….</pre>

<p>Работает это так, все основные настройки хранятся в base.py и мы используем нужные настройки для нужного окружения, примеру local.py будет выглядеть вот так:</p>

<pre># -*- coding: utf-8 -*-
from .base import *

BASE_HOST = "http://example.com/"
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': ‘project',
        'USER': 'root',
        'PASSWORD': '',  
        'HOST': 'localhost',
        'PORT': ''
    }
}

CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.dummy.DummyCache',
    }
}


DEBUG = True
TEMPLATE_DEBUG = DEBUG
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

INSTALLED_APPS += ('debug_toolbar')&lt;/code&gt;</pre>

<p>И для запуска тестового сервера нам нужно ввести команду:</p>

<pre>python manage.py runserver --settings=project.settings.local</pre>

<p>Теперь все конфигурационный файлы для всех окружений можно хранить в системе контроля версий, ненужно создавать лишних файлов в окружении.</p>

<p>Теперь можно плавно перейти к хранению секретных настроек, таких как SECRET_KEY, логин/пароль от бд, логин/пароль от почтового сервера и тд. Как мы все понимаем хранение это информации в контроле версий крайне не правильна, поэтому мне кажется лучше это хранить в системный переменных, для этого нужно задать нужную информацию в .bashrc, .bash_profile или .profile или если вы используете virtualenvs то достаточно дописать нужную информацию в bin/activate, к примеру мы хотим задать SECRET_KEY и пароль от БД:</p>

<pre>export MY_SECRET_KEY=$)a7n&amp;o80u!6y5t-+j
export MY_BD_PASS=qweasd</pre>

<p>Как же получить доступ к этим настройка из django? Да все просто все это есть в модуле os:</p>

<pre>import os

SECRET_KEY = os.environ&amp;#91;‘MY_SECRET_KEY'&amp;#93;</pre>

<p>Но это не очень красиво и нужно отлавливать ошибки, поэтому правильней написать функцию:</p>

<pre>import os
from django.core.exceptions import ImpropelyConfigured


def get_env_setting(var):
     try:
          return os.environ&amp;#91;var&amp;#93;
     excapt KeyError:
          msg = u”Переменная %s не задана” % var
          raise ImpropelyConfigured(msg)

SECRET_KEY = get_env_setting(‘MY_SECRET_KEY’)&lt;/code&gt;</pre>

<p>Теперь все красиво и безопасно.</p>

    </article>
  </body>
</html>
